<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - SWIFT CHOW</title>
    <meta name="description" content="Manage your SWIFT CHOW account, orders, and preferences.">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body data-page="account">
    <script>
        // Protect this page - check token in localStorage
        (function() {
            // Function to check if user is authenticated
            function checkAuth() {
                const token = localStorage.getItem('authToken');
                const hasToken = !!token && token.length > 0;
                console.log('Account page: Token check -', hasToken ? 'Authenticated' : 'Not authenticated');
                
                if (!hasToken) {
                    console.log('Not authenticated, redirecting to login');
                    window.location.href = 'login.html?return=' + encodeURIComponent(window.location.pathname);
                }
            }
            
            // Check immediately and after scripts load
            checkAuth();
            setTimeout(checkAuth, 500);
        })();
    </script>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <a href="index.html" class="logo">
                <div class="logo-icon">üçî</div>
                <span class="logo-text">SWIFT <span>CHOW</span></span>
            </a>
            
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="reviews.html">Reviews</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            
            <div class="nav-actions">
                <button class="nav-icon dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="cart.html" class="nav-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" style="display: none;">0</span>
                </a>
                <button id="loginBtn" class="btn btn-primary btn-sm"><i class="fas fa-user"></i> Login</button>
                <div class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <ul class="mobile-nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
    </nav>
    
    <!-- Account Section - Premium Layout -->
    <section class="premium-account-section">
        <div class="premium-account-container">
            <!-- Premium Sidebar Navigation -->
            <aside class="premium-sidebar">
                <div class="sidebar-user-card">
                    <div class="user-avatar-large">
                        <span id="userAvatarInitials">--</span>
                    </div>
                    <h3 class="user-name" id="userDisplayName">User Name</h3>
                    <p class="user-email" id="userDisplayEmail">user@email.com</p>
                    <div class="user-status">
                        <span class="status-badge">Premium Member</span>
                    </div>
                </div>
                
                <nav class="premium-nav-menu">
                    <a href="#" class="nav-item active" data-section="profile">
                        <div class="nav-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">My Profile</span>
                            <span class="nav-subtitle">Personal info</span>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item" data-section="orders">
                        <div class="nav-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">My Orders</span>
                            <span class="nav-subtitle">Order history</span>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item" data-section="addresses">
                        <div class="nav-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">Addresses</span>
                            <span class="nav-subtitle">Saved locations</span>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item" data-section="payments">
                        <div class="nav-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">Payments</span>
                            <span class="nav-subtitle">Payment methods</span>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item" data-section="settings">
                        <div class="nav-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">Settings</span>
                            <span class="nav-subtitle">Preferences</span>
                        </div>
                    </a>
                    
                    <a href="#" class="nav-item" data-section="help">
                        <div class="nav-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div class="nav-content">
                            <span class="nav-title">Support</span>
                            <span class="nav-subtitle">Get help</span>
                        </div>
                    </a>
                </nav>
            </aside>
            
            <!-- Premium Content Area -->
            <main class="premium-content-area">
                
                <!-- Profile Section -->
                <div class="content-section active" id="profile">
                    <div class="section-header">
                        <h2>My Profile</h2>
                        <p>Manage your personal information</p>
                    </div>
                    
                    <div class="form-card">
                        <form class="profile-form" id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <input type="text" name="firstName" placeholder="Enter your first name" value="" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <input type="text" name="lastName" placeholder="Enter your last name" value="" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" name="email" placeholder="your@email.com" value="" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" name="phone" placeholder="+233 XXX XXX XXXX" value="" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date of Birth</label>
                                    <input type="date" name="dob" value="">
                                </div>
                                <div class="form-group">
                                    <label>Gender</label>
                                    <select name="gender" required>
                                        <option value="">Select gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <button type="reset" class="btn btn-outline">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Orders Section -->
                <div class="content-section" id="orders">
                    <div class="section-header">
                        <h2>My Orders</h2>
                        <p>View and manage your order history</p>
                    </div>
                    
                    <div class="orders-list" id="ordersContainer">
                        <p style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                            No orders yet. Start placing orders to see them here!
                        </p>
                    </div>
                </div>
                
                <!-- Addresses Section -->
                <div class="content-section" id="addresses">
                    <div class="section-header">
                        <h2>Saved Addresses</h2>
                        <p>Manage your delivery locations</p>
                    </div>
                    
                    <div class="addresses-grid" id="addressesContainer">
                        <p style="text-align: center; padding: 2rem; color: var(--text-secondary); grid-column: 1/-1;">
                            <i class="fas fa-map-marker-alt" style="font-size: 2rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                            No saved addresses yet. Add one for faster checkout!
                        </p>
                    </div>
                    
                    <div class="add-section">
                        <button class="btn btn-primary btn-lg">
                            <i class="fas fa-plus"></i> Add New Address
                        </button>
                    </div>
                </div>
                
                <!-- Payments Section -->
                <div class="content-section" id="payments">
                    <div class="section-header">
                        <h2>Payment Methods</h2>
                        <p>Manage your saved payment methods</p>
                    </div>
                    
                    <div class="payments-list" id="paymentsContainer">
                        <p style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <i class="fas fa-credit-card" style="font-size: 2rem; margin-bottom: 1rem; display: block; opacity: 0.5;"></i>
                            No payment methods saved yet. Add one to check out faster!
                        </p>
                    </div>
                    
                    <div class="add-section">
                        <button class="btn btn-primary btn-lg">
                            <i class="fas fa-plus"></i> Add Payment Method
                        </button>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div class="content-section" id="settings">
                    <div class="section-header">
                        <h2>Settings</h2>
                        <p>Manage your preferences and security</p>
                    </div>
                    
                    <div class="settings-groups">
                        <div class="settings-group">
                            <h4>Notifications</h4>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <p class="setting-label">Order Updates</p>
                                    <p class="setting-desc">Get notified when your order status changes</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="order-updates" name="orderUpdates" checked>
                                    <label for="order-updates"></label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <p class="setting-label">Promotions</p>
                                    <p class="setting-desc">Receive special offers and promotions</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="promotions" name="promotions" checked>
                                    <label for="promotions"></label>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <p class="setting-label">Email Newsletters</p>
                                    <p class="setting-desc">Subscribe to our weekly newsletter</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="newsletters" name="newsletters">
                                    <label for="newsletters"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h4>Privacy & Security</h4>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <p class="setting-label">Change Password</p>
                                    <p class="setting-desc">Update your account password</p>
                                </div>
                                <button class="btn btn-sm btn-outline">Change</button>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <p class="setting-label">Two-Factor Authentication</p>
                                    <p class="setting-desc">Add extra security to your account</p>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="2fa" name="twoFactor">
                                    <label for="2fa"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-group danger">
                            <h4>Danger Zone</h4>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Delete your account permanently</p>
                            <button class="btn btn-outline btn-danger" onclick="deleteUserAccount()">
                                <i class="fas fa-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Help Section -->
                <div class="content-section" id="help">
                    <div class="section-header">
                        <h2>Help & Support</h2>
                        <p>Get assistance with your account</p>
                    </div>
                    
                    <div class="faq-grid">
                        <div class="faq-card">
                            <div class="faq-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <h4>How do I reset my password?</h4>
                            <p>Visit the forgot password page and follow the instructions sent to your email.</p>
                        </div>
                        
                        <div class="faq-card">
                            <div class="faq-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h4>What are your delivery hours?</h4>
                            <p>We deliver from 10 AM to 11 PM daily. Orders must be placed 30 minutes before close.</p>
                        </div>
                        
                        <div class="faq-card">
                            <div class="faq-icon">
                                <i class="fas fa-undo"></i>
                            </div>
                            <h4>Can I cancel my order?</h4>
                            <p>Orders can be cancelled within 5 minutes of placement. Contact support for assistance.</p>
                        </div>
                        
                        <div class="faq-card">
                            <div class="faq-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <h4>Contact Support</h4>
                            <p>Need help? Call us at <strong>+233 50 507 0941</strong> or email support@swiftchow.com</p>
                        </div>
                    </div>
                </div>
                
            </main>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="logoGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M12 2L18 12H13L16 22L6 10H11L12 2Z" fill="url(#logoGrad2)" />
                                <path d="M3 14L6 15" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.8"/>
                                <path d="M2 10L5 11" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.6"/>
                            </svg>
                        </div>
                        <span class="logo-text">SWIFT <span>CHOW</span></span>
                    </a>
                    <p>Ghana's favorite fast food destination. Fresh ingredients, amazing taste, and lightning-fast delivery.</p>
                    <div class="footer-social">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="menu.html">Our Menu</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="reviews.html">Reviews</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="tracking.html">Track Order</a></li>
                        <li><a href="terms.html">Terms & Conditions</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="contact.html#faq">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Contact Us</h4>
                    <div class="footer-contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>25 Independence Ave, Osu, Accra, Ghana</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-phone"></i>
                        <span>+233 50 507 0941</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>orders@swiftchow.com</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-clock"></i>
                        <span>Mon-Sun: 8:00 AM - 10:00 PM</span>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 SWIFT CHOW. Designed by Ayensu Edwin Yaw Boadi</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript Files - Order matters! -->
    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>

    <!-- LOGIN MODAL -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
            
            <div class="modal-header">
                <a href="#" class="logo">
                    <div class="logo-icon"><i class="fas fa-bolt"></i></div>
                    <div class="logo-text">SWIFT <span>CHOW</span></div>
                </a>
                <h2>Welcome Back!</h2>
                <p>Log in to your account to continue</p>
            </div>

            <div class="modal-body">
                <form id="loginModalForm" class="form">
                    <div class="form-group">
                        <label for="login-email">Email Address</label>
                        <input type="email" id="login-email" name="email" placeholder="your@email.com" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Email verified</div>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" placeholder="Enter your password" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Password valid</div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 1rem 0;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="remember">
                            <span>Remember me</span>
                        </label>
                        <a href="forgot-password.html" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 1.5rem;">Sign In</button>
                </form>

                <div style="margin: 2rem 0; position: relative;">
                    <div style="border-top: 1px solid var(--border-color);"></div>
                    <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--bg-primary); padding: 0 1rem; color: var(--text-secondary); font-size: 0.85rem;">or continue with</span>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button type="button" class="btn btn-outline" onclick="googleSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-google"></i> Google</button>
                    <button type="button" class="btn btn-outline" onclick="facebookSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-facebook"></i> Facebook</button>
                </div>
            </div>

            <div class="modal-footer">
                Don't have an account? <a href="#" data-action="switch-to-signup">Sign up</a>
            </div>
        </div>
    </div>

    <!-- SIGNUP MODAL -->
    <div id="signupModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
            
            <div class="modal-header">
                <a href="#" class="logo">
                    <div class="logo-icon"><i class="fas fa-bolt"></i></div>
                    <div class="logo-text">SWIFT <span>CHOW</span></div>
                </a>
                <h2>Join Us!</h2>
                <p>Create your account to start ordering</p>
            </div>

            <div class="modal-body">
                <form id="signupModalForm" class="form">
                    <div class="form-group">
                        <label for="signup-fullname">Full Name</label>
                        <input type="text" id="signup-fullname" name="fullName" placeholder="Your full name" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Name valid</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" name="email" placeholder="your@email.com" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Email verified</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-phone">Phone Number</label>
                        <input type="tel" id="signup-phone" name="phone" placeholder="+233 50 507 0941" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Phone valid</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" name="password" placeholder="At least 6 characters" required>
                            <div class="form-feedback error" style="display: none;"></div>
                            <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Password valid</div>
                        </div>
                        <div class="form-group">
                            <label for="signup-confirm">Confirm Password</label>
                            <input type="password" id="signup-confirm" name="confirmPassword" placeholder="Confirm password" required>
                            <div class="form-feedback error" style="display: none;"></div>
                            <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Passwords match</div>
                        </div>
                    </div>

                    <label style="display: flex; align-items: flex-start; gap: 0.5rem; margin: 1rem 0; cursor: pointer;">
                        <input type="checkbox" name="terms" required style="margin-top: 0.3rem;">
                        <span style="font-size: 0.9rem;">I agree to the <a href="terms.html" style="color: var(--primary);">Terms & Conditions</a></span>
                    </label>

                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 1.5rem;">Create Account</button>
                </form>

                <div style="margin: 2rem 0; position: relative;">
                    <div style="border-top: 1px solid var(--border-color);"></div>
                    <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--bg-primary); padding: 0 1rem; color: var(--text-secondary); font-size: 0.85rem;">or sign up with</span>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button type="button" class="btn btn-outline" onclick="googleSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-google"></i> Google</button>
                    <button type="button" class="btn btn-outline" onclick="facebookSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-facebook"></i> Facebook</button>
                </div>
            </div>

            <div class="modal-footer">
                Already have an account? <a href="#" data-action="switch-to-login">Sign in</a>
            </div>
        </div>
    </div>

    <script>
    // Account Page Functionality
    document.addEventListener('DOMContentLoaded', () => {
        // Load user data from localStorage
        const user = JSON.parse(localStorage.getItem('currentUser')) || {};
        
        // Update sidebar user info
        const userNameEl = document.querySelector('.user-name');
        const userEmailEl = document.querySelector('.user-email');
        const userAvatarEl = document.querySelector('.user-avatar-large span');
        
        if (userNameEl) userNameEl.textContent = user.fullName || 'User';
        if (userEmailEl) userEmailEl.textContent = user.email || 'user@example.com';
        if (userAvatarEl) {
            const initial = (user.fullName || user.email || 'U').charAt(0).toUpperCase();
            userAvatarEl.textContent = initial;
        }
        
        // Populate profile form with user data
        const profileForm = document.querySelector('.profile-form');
        if (profileForm && user.fullName) {
            const nameParts = user.fullName.split(' ');
            const firstNameInput = profileForm.querySelector('input[placeholder="John"]');
            const lastNameInput = profileForm.querySelector('input[placeholder="Doe"]');
            const emailInput = profileForm.querySelector('input[type="email"]');
            const phoneInput = profileForm.querySelector('input[type="tel"]');
            
            if (firstNameInput) firstNameInput.value = nameParts[0] || '';
            if (lastNameInput) lastNameInput.value = nameParts.slice(1).join(' ') || '';
            if (emailInput) emailInput.value = user.email || '';
            if (phoneInput) phoneInput.value = user.phone || '';
        }
        
        // Handle sidebar navigation
        const navItems = document.querySelectorAll('.premium-nav-menu .nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remove active from all items and sections
                navItems.forEach(i => i.classList.remove('active'));
                contentSections.forEach(section => section.classList.remove('active'));
                
                // Add active to clicked item and corresponding section
                item.classList.add('active');
                const sectionId = item.getAttribute('data-section');
                const sectionEl = document.getElementById(sectionId);
                if (sectionEl) sectionEl.classList.add('active');
            });
        });
        
        // Profile form save
        if (profileForm) {
            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const firstNameInput = profileForm.querySelector('input[placeholder="John"]');
                const lastNameInput = profileForm.querySelector('input[placeholder="Doe"]');
                const phoneInput = profileForm.querySelector('input[type="tel"]');
                
                const updatedUser = {
                    ...user,
                    fullName: `${firstNameInput.value} ${lastNameInput.value}`.trim(),
                    phone: phoneInput.value
                };
                
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                
                // Show success message
                showAdvancedToast('Profile updated successfully!', 'success');
                
                // Update sidebar
                if (userNameEl) userNameEl.textContent = updatedUser.fullName;
                if (userAvatarEl) {
                    const initial = updatedUser.fullName.charAt(0).toUpperCase();
                    userAvatarEl.textContent = initial;
                }
            });
        }
        
        // Change password handler
        const changePasswordBtns = document.querySelectorAll('[data-action="change-password"]');
        changePasswordBtns.forEach(btn => {
            if (!btn) {
                // Create the button if it doesn't exist
                const settingsGroup = document.querySelector('.settings-group');
                if (settingsGroup) {
                    const changePasswordBtn = document.querySelector('.settings-group').querySelector('button[class*="Change"]');
                    if (changePasswordBtn) {
                        changePasswordBtn.addEventListener('click', () => {
                            showChangePasswordModal();
                        });
                    }
                }
            }
        });
        
        // Handle change password button
        const settingsGroup = document.querySelector('.settings-group');
        if (settingsGroup) {
            const changePasswordBtn = settingsGroup.querySelector('button');
            if (changePasswordBtn && changePasswordBtn.textContent.includes('Change')) {
                changePasswordBtn.addEventListener('click', () => {
                    showChangePasswordModal();
                });
            }
        }
        
        // Handle delete account button
        const deleteAccountBtn = document.querySelector('.btn-danger');
        if (deleteAccountBtn) {
            deleteAccountBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                    if (confirm('This will permanently delete all your data. Type YES to confirm.')) {
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('users');
                        localStorage.removeItem('fafoCart');
                        showAdvancedToast('Account deleted. Logging out...', 'warning');
                        setTimeout(() => {
                            location.href = 'index.html';
                        }, 1500);
                    }
                }
            });
        }
        
        // Handle add payment method - select specifically from the payments section
        const paymentsSection = document.getElementById('payments');
        if (paymentsSection) {
            const addPaymentBtn = paymentsSection.querySelector('.add-section .btn');
            if (addPaymentBtn) {
                addPaymentBtn.addEventListener('click', () => {
                    showAddPaymentModal();
                });
            }
        }
        
        // Handle add address - select specifically from the addresses section
        const addressesSection = document.getElementById('addresses');
        if (addressesSection) {
            const addAddressBtn = addressesSection.querySelector('.add-section .btn');
            if (addAddressBtn) {
                addAddressBtn.addEventListener('click', () => {
                    showAddAddressModal();
                });
            }
        }
    });
    
    function showChangePasswordModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active';
        modal.id = 'changePasswordModal';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 450px;">
                <button class="modal-close" onclick="document.getElementById('changePasswordModal').remove();"><i class="fas fa-times"></i></button>
                <div class="modal-header">
                    <h2>Change Password</h2>
                    <p>Enter your current password and new password</p>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm" class="form">
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" id="currentPassword" name="currentPassword" placeholder="Enter current password" required>
                            <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('currentPassword')" title="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" required>
                            <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('newPassword')" title="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="confirmNewPassword" name="confirmNewPassword" placeholder="Confirm new password" required>
                            <button type="button" class="password-toggle-btn" onclick="togglePasswordVisibility('confirmNewPassword')" title="Show password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Update Password</button>
                    </form>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        const form = document.getElementById('changePasswordForm');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (newPassword !== confirmPassword) {
                showAdvancedToast('Passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showAdvancedToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            const user = JSON.parse(localStorage.getItem('currentUser')) || {};
            user.password = newPassword;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            showAdvancedToast('Password changed successfully!', 'success');
            document.getElementById('changePasswordModal').remove();
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
    
    function showAddPaymentModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active';
        modal.id = 'addPaymentModal';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 450px;">
                <button class="modal-close" onclick="document.getElementById('addPaymentModal').remove();"><i class="fas fa-times"></i></button>
                <div class="modal-header">
                    <h2>Add Payment Method</h2>
                    <p>Add a new card or mobile money account</p>
                </div>
                <div class="modal-body">
                    <form id="addPaymentForm" class="form">
                        <div class="form-group">
                            <label>Payment Type</label>
                            <select id="paymentType" name="paymentType" required>
                                <option value="card">Credit/Debit Card</option>
                                <option value="momo">Mobile Money</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                        
                        <div id="momoTelecomContainer" style="display: none;" class="form-group">
                            <label>Mobile Network</label>
                            <select id="telecomProvider" name="telecom" required>
                                <option value="">Select Network</option>
                                <option value="vodafone">Vodafone Cash</option>
                                <option value="mtn">MTN Mobile Money</option>
                                <option value="airtel">AirtelTigo Money</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="cardFieldsContainer">
                            <label id="cardNumberLabel">Card Number</label>
                            <input type="text" id="paymentInput" name="paymentInput" placeholder="1234 5678 9012 3456" required>
                        </div>
                        <div class="form-group" id="cardholderContainer">
                            <label>Cardholder Name</label>
                            <input type="text" id="cardholderName" name="cardholderName" placeholder="Your Name" required>
                        </div>
                        <div class="form-row" id="cardExpiryContainer">
                            <div class="form-group">
                                <label>Expiry Date</label>
                                <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" required>
                            </div>
                            <div class="form-group">
                                <label>CVV</label>
                                <input type="text" id="cvv" name="cvv" placeholder="123" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Add Payment Method</button>
                    </form>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        const form = document.getElementById('addPaymentForm');
        const paymentType = document.getElementById('paymentType');
        const momoTelecomContainer = document.getElementById('momoTelecomContainer');
        const cardNumberLabel = document.getElementById('cardNumberLabel');
        const paymentInput = document.getElementById('paymentInput');
        const cardholderContainer = document.getElementById('cardholderContainer');
        const cardExpiryContainer = document.getElementById('cardExpiryContainer');
        
        paymentType.addEventListener('change', (e) => {
            if (e.target.value === 'momo') {
                momoTelecomContainer.style.display = 'block';
                cardNumberLabel.textContent = 'Phone Number';
                paymentInput.placeholder = '0550507094';
                cardholderContainer.style.display = 'none';
                cardExpiryContainer.style.display = 'none';
            } else if (e.target.value === 'bank') {
                momoTelecomContainer.style.display = 'none';
                cardNumberLabel.textContent = 'Account Number';
                paymentInput.placeholder = '1234567890';
                cardholderContainer.style.display = 'block';
                cardExpiryContainer.style.display = 'none';
            } else {
                momoTelecomContainer.style.display = 'none';
                cardNumberLabel.textContent = 'Card Number';
                paymentInput.placeholder = '1234 5678 9012 3456';
                cardholderContainer.style.display = 'block';
                cardExpiryContainer.style.display = 'flex';
            }
        });
        
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = {
                type: paymentType.value,
                lastFour: paymentInput.value.slice(-4),
                cardholderName: document.getElementById('cardholderName').value || 'Payment Method',
                network: document.getElementById('telecomProvider').value || '',
                addedAt: new Date().toISOString()
            };
            
            // Save to localStorage
            let user = JSON.parse(localStorage.getItem('fafoUser') || '{}');
            if (!user.paymentMethods) user.paymentMethods = [];
            user.paymentMethods.push(formData);
            localStorage.setItem('fafoUser', JSON.stringify(user));
            
            showAdvancedToast('Payment method added successfully!', 'success');
            document.getElementById('addPaymentModal').remove();
            
            // Refresh payments display
            if (window.loadPayments) window.loadPayments();
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
    
    function showAddAddressModal() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active';
        modal.id = 'addAddressModal';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 450px;">
                <button class="modal-close" onclick="document.getElementById('addAddressModal').remove();"><i class="fas fa-times"></i></button>
                <div class="modal-header">
                    <h2>Add New Address</h2>
                    <p>Add a new delivery address</p>
                </div>
                <div class="modal-body">
                    <form id="addAddressForm" class="form">
                        <div class="form-group">
                            <label>Address Type</label>
                            <select name="addressType" required>
                                <option value="">Select Type</option>
                                <option value="home">Home</option>
                                <option value="office">Office</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Street Address</label>
                            <input type="text" name="street" placeholder="Street address, house number" required>
                        </div>
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" name="city" placeholder="Accra" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Postal Code</label>
                                <input type="text" name="postalCode" placeholder="00233" required>
                            </div>
                            <div class="form-group">
                                <label>Country</label>
                                <input type="text" name="country" placeholder="Ghana" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" name="phone" placeholder="+233 50 507 0941" required>
                        </div>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin: 1rem 0; cursor: pointer;">
                            <input type="checkbox" name="isDefault">
                            <span>Set as default address</span>
                        </label>
                        <button type="submit" class="btn btn-primary btn-block">Add Address</button>
                    </form>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        const form = document.getElementById('addAddressForm');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const addressData = {
                type: formData.get('addressType'),
                street: formData.get('street'),
                city: formData.get('city'),
                postalCode: formData.get('postalCode'),
                country: formData.get('country'),
                phone: formData.get('phone'),
                isDefault: formData.get('isDefault') === 'on',
                addedAt: new Date().toISOString()
            };
            
            // Save to localStorage
            let user = JSON.parse(localStorage.getItem('fafoUser') || '{}');
            if (!user.addresses) user.addresses = [];
            user.addresses.push(addressData);
            localStorage.setItem('fafoUser', JSON.stringify(user));
            
            showAdvancedToast('Address added successfully!', 'success');
            document.getElementById('addAddressModal').remove();
            
            // Refresh addresses display
            if (window.loadAddresses) window.loadAddresses();
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
    </script>

    <!-- CART MODAL PANEL -->
    <div id="cartModal" class="modal-overlay">
        <div class="modal-content" style="position: fixed; right: 0; top: 0; max-width: 450px; height: 100vh; border-radius: 0; max-height: 100vh; overflow-y: auto; animation: slideInRight 0.3s ease;">
            <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0;"><i class="fas fa-shopping-cart"></i> Your Cart</h2>
                <button class="modal-close" onclick="closeModal(document.getElementById('cartModal')); document.body.style.overflow = 'auto';" aria-label="Close cart"><i class="fas fa-times" style="font-size: 1.5rem;"></i></button>
            </div>

            <div class="modal-body" style="padding: 1.5rem; padding-bottom: 200px; min-height: calc(100vh - 300px);">
                <div class="cart-items-modal-list">
                    <!-- Cart items will be rendered here by JavaScript -->
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; opacity: 0.5; margin-bottom: 1rem;"></i>
                        <p>Your cart is empty</p>
                        <a href="menu.html" class="btn btn-primary btn-sm" style="margin-top: 1rem;">Browse Menu</a>
                    </div>
                </div>
            </div>

            <div style="position: fixed; bottom: 0; right: 0; width: 450px; background: var(--bg-primary); border-top: 1px solid var(--border-color); padding: 1.5rem;">
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; font-size: 0.95rem;">
                        <span>Subtotal:</span>
                        <span class="cart-subtotal">GHS 0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); font-size: 0.95rem;">
                        <span>Delivery:</span>
                        <span class="cart-delivery">GHS 15.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; color: var(--primary);">
                        <span>Total:</span>
                        <span class="cart-total">GHS 0.00</span>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                    <button class="btn btn-outline" onclick="closeModal(document.getElementById('cartModal')); document.body.style.overflow = 'auto';" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-arrow-left"></i> Continue
                    </button>
                    <button class="btn btn-primary" onclick="proceedToCheckout()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-lock"></i> Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load user profile data on page load
        function loadProfileData() {
            const user = getCurrentUser();
            if (!user) {
                console.log('Profile: No user data found');
                return;
            }
            
            console.log('Profile: Loading user data:', user.email);
            
            // Get form inputs
            const firstNameInput = document.querySelector('input[placeholder="John"]');
            const lastNameInput = document.querySelector('input[placeholder="Doe"]');
            const emailInput = document.querySelector('input[type="email"]');
            const phoneInput = document.querySelector('input[type="tel"]');
            
            if (firstNameInput) {
                firstNameInput.value = user.firstName || '';
            }
            if (lastNameInput) {
                lastNameInput.value = user.lastName || '';
            }
            if (emailInput) {
                emailInput.value = user.email || '';
            }
            if (phoneInput) {
                phoneInput.value = user.phone || '';
            }
            
            console.log('Profile: User data loaded into form');
        }
        
        // Save profile changes
        document.addEventListener('DOMContentLoaded', () => {
            // Load profile data after a short delay to ensure scripts are loaded
            setTimeout(loadProfileData, 100);
            
            // Handle profile form submission
            const profileForm = document.querySelector('.profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const firstName = document.querySelector('input[placeholder="John"]').value;
                    const lastName = document.querySelector('input[placeholder="Doe"]').value;
                    const phone = document.querySelector('input[type="tel"]').value;
                    
                    console.log('Profile: Saving changes...', { firstName, lastName, phone });
                    
                    try {
                        const response = await apiCall('/users/profile', {
                            method: 'PUT',
                            body: JSON.stringify({
                                firstName,
                                lastName,
                                phone
                            })
                        });
                        
                        if (response.success) {
                            // Update currentUser
                            currentUser = {
                                ...currentUser,
                                firstName,
                                lastName,
                                phone
                            };
                            localStorage.setItem('fafoUser', JSON.stringify(currentUser));
                            
                            alert('Profile updated successfully!');
                            console.log('Profile: Saved successfully');
                        } else {
                            alert('Error saving profile: ' + (response.message || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Profile: Save error:', error);
                        alert('Error saving profile. Please try again.');
                    }
                });
            }
        });
    </script>
</body>
</html>
