# SWIFT CHOW - Deployment Guide
## Production Deployment to Render with MongoDB & OAuth

---

## üìã Prerequisites

Before deploying, make sure you have:

1. **GitHub Account** - For pushing code
2. **Render Account** - Free at https://render.com
3. **MongoDB Account** - Free tier at https://mongodb.com/cloud/atlas
4. **Google OAuth Credentials** - From Google Cloud Console
5. **Facebook OAuth Credentials** - From Facebook Developers

---

## üîß Step 1: Set Up MongoDB Atlas

### 1.1 Create MongoDB Account
- Go to https://mongodb.com/cloud/atlas
- Sign up for free account
- Create a new project

### 1.2 Create Database Cluster
1. Click "Create" under Clusters
2. Choose M0 (free tier)
3. Select your region (closest to your users)
4. Click "Create Cluster"

### 1.3 Create Database User
1. Go to "Database Access"
2. Click "Add New Database User"
3. Create username and password (save these!)
4. Select "Autogenerated Secure Password"
5. Click "Add User"

### 1.4 Get Connection String
1. Click "Databases" ‚Üí "Connect"
2. Choose "Connect your application"
3. Copy the connection string
4. Replace `<username>`, `<password>`, `<dbname>`

**Your MongoDB URI should look like:**
```
mongodb+srv://username:password@cluster-name.mongodb.net/swift-chow
```

---

## üîê Step 2: Set Up Google OAuth

### 2.1 Create Google Cloud Project
1. Go to https://console.cloud.google.com
2. Click "Select a Project" ‚Üí "New Project"
3. Name it "SWIFT CHOW"
4. Click "Create"

### 2.2 Enable Google+ API
1. Search for "Google+ API"
2. Click "Enable"

### 2.3 Create OAuth Credentials
1. Go to "Credentials" in left menu
2. Click "Create Credentials" ‚Üí "OAuth Client ID"
3. Choose "Web Application"
4. Add authorized origins:
   - `http://localhost:5000`
   - `https://your-render-app.onrender.com` (you'll get this URL later)
5. Add authorized redirect URIs:
   - `http://localhost:5000/api/auth/google/callback`
   - `https://your-render-app.onrender.com/api/auth/google/callback`
6. Click "Create"
7. Copy Client ID and Client Secret

---

## üì± Step 3: Set Up Facebook OAuth

### 3.1 Create Facebook App
1. Go to https://developers.facebook.com
2. Click "My Apps" ‚Üí "Create App"
3. Choose "Consumer" type
4. Fill in app details
5. Click "Create App"

### 3.2 Configure Facebook Login
1. In app dashboard, add "Facebook Login" product
2. Go to Settings ‚Üí Basic and copy App ID and App Secret
3. Go to Settings ‚Üí Basic ‚Üí App Domains
4. Add:
   - `localhost:5000`
   - `your-render-app.onrender.com`
5. Go to Products ‚Üí Facebook Login ‚Üí Settings
6. Add valid OAuth Redirect URIs:
   - `http://localhost:5000/api/auth/facebook/callback`
   - `https://your-render-app.onrender.com/api/auth/facebook/callback`

---

## üì¶ Step 4: Prepare Code for Deployment

### 4.1 Update server.js for ESM Modules
Make sure your `package.json` has:
```json
"type": "module"
```

### 4.2 Create .env File
Copy `.env.example` to `.env` and fill in your values:

```bash
NODE_ENV=production
PORT=5000
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/swift-chow
JWT_SECRET=your-random-secret-key-here
SESSION_SECRET=another-random-secret-key
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=https://your-render-app.onrender.com/api/auth/google/callback
FACEBOOK_APP_ID=your-facebook-app-id
FACEBOOK_APP_SECRET=your-facebook-app-secret
FACEBOOK_CALLBACK_URL=https://your-render-app.onrender.com/api/auth/facebook/callback
CLIENT_URL=https://your-render-app.onrender.com
```

### 4.3 Create .gitignore
```
node_modules/
.env
.env.local
.DS_Store
*.log
```

---

## üöÄ Step 5: Deploy to Render

### 5.1 Push Code to GitHub
1. Initialize git repository:
   ```bash
   git init
   git add .
   git commit -m "Initial commit: SWIFT CHOW with MongoDB and OAuth"
   git branch -M main
   ```

2. Create repository on GitHub and push:
   ```bash
   git remote add origin https://github.com/username/swift-chow.git
   git push -u origin main
   ```

### 5.2 Create Render Deployment
1. Go to https://render.com
2. Sign up with GitHub account
3. Click "New +" ‚Üí "Web Service"
4. Connect your GitHub repository
5. Select "swift-chow" repository
6. Configure deployment:
   - **Name**: swift-chow
   - **Runtime**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `node server.js`

### 5.3 Add Environment Variables
In Render dashboard:
1. Go to your service ‚Üí "Environment"
2. Add all variables from `.env.example`:

```
NODE_ENV = production
MONGODB_URI = [your-mongodb-uri]
JWT_SECRET = [generate-random-secret]
SESSION_SECRET = [generate-random-secret]
GOOGLE_CLIENT_ID = [your-google-client-id]
GOOGLE_CLIENT_SECRET = [your-google-client-secret]
GOOGLE_CALLBACK_URL = https://your-render-app.onrender.com/api/auth/google/callback
FACEBOOK_APP_ID = [your-facebook-app-id]
FACEBOOK_APP_SECRET = [your-facebook-app-secret]
FACEBOOK_CALLBACK_URL = https://your-render-app.onrender.com/api/auth/facebook/callback
CLIENT_URL = https://your-render-app.onrender.com
```

### 5.4 Deploy
1. Click "Deploy"
2. Wait for build to complete (3-5 minutes)
3. Once live, Render will give you your URL

---

## ‚úÖ Testing Deployment

### Test 1: Health Check
```
GET https://your-render-app.onrender.com/api/health
```

Expected response:
```json
{
  "status": "OK",
  "timestamp": "2024-...",
  "user": null
}
```

### Test 2: Google Login
1. Visit `https://your-render-app.onrender.com/login`
2. Click "Login with Google"
3. Should redirect to Google OAuth flow

### Test 3: Facebook Login
1. Visit `https://your-render-app.onrender.com/login`
2. Click "Login with Facebook"
3. Should redirect to Facebook OAuth flow

### Test 4: Create Order
```bash
curl -X POST https://your-render-app.onrender.com/api/orders/create \
  -H "Content-Type: application/json" \
  -H "Cookie: token=[your-jwt-token]" \
  -d '{
    "items": [{"foodId": 1, "quantity": 1, "price": 25}],
    "deliveryAddress": {"street": "123 Main St", "city": "Accra"},
    "paymentMethod": "cod"
  }'
```

---

## üîß Troubleshooting

### MongoDB Connection Issues
- Check that Render's IP is whitelisted in MongoDB Atlas
- Go to MongoDB Atlas ‚Üí Network Access
- Click "Add IP Address"
- Add `0.0.0.0/0` (or Render's IP if available)

### OAuth Callback URL Mismatch
- Ensure callback URLs in Google/Facebook match your Render URL
- URLs are case-sensitive
- Must include trailing slash if configured that way

### Environment Variables Not Loading
- Restart the service after adding env vars
- Check Render logs for errors:
  - Go to Service ‚Üí "Logs"
  - Look for error messages

### "Cannot GET /api/health"
- Wait 5-10 minutes for build to complete
- Check build logs for errors
- Ensure port 5000 is exposed

---

## üì± Update Frontend API Calls

Update your frontend JavaScript to use the production API:

```javascript
const API_URL = process.env.NODE_ENV === 'production' 
  ? 'https://your-render-app.onrender.com'
  : 'http://localhost:5000';

// Example API call
fetch(`${API_URL}/api/auth/login`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ email, password }),
  credentials: 'include'
});
```

---

## üîí Security Checklist

- [x] `.env` file is in `.gitignore`
- [x] All secrets are set in Render environment variables
- [x] SSL/HTTPS is enabled on Render (automatic)
- [x] MongoDB password is strong and unique
- [x] JWT secret is long and random
- [x] Session secret is long and random
- [x] OAuth URLs are HTTPS in production

---

## üìä Monitoring & Logs

### View Logs
1. Go to Render Dashboard
2. Select "swift-chow" service
3. Click "Logs" tab
4. View real-time logs

### Monitor Performance
- Response times
- Error rates
- Database connection status

### Common Errors
```
MongooseError: Cannot connect to MongoDB
‚Üí Check MONGODB_URI and IP whitelist

AuthenticationError: OAuth callback failed
‚Üí Check callback URLs match exactly

Token verification failed
‚Üí Check JWT_SECRET matches

Port 5000 already in use
‚Üí Render assigns port automatically
```

---

## üöÄ Next Steps

1. **Enable HTTPS/SSL** - Automatic with Render
2. **Set up CDN** - For static assets
3. **Add email verification** - For user signups
4. **Implement rate limiting** - Prevent abuse
5. **Add payment processing** - Stripe or Paystack
6. **Set up CI/CD** - Automatic tests on push
7. **Add monitoring** - Error tracking with Sentry

---

## üìö Useful Links

- Render Docs: https://render.com/docs
- MongoDB Atlas: https://mongodb.com/cloud/atlas
- Google Cloud Console: https://console.cloud.google.com
- Facebook Developers: https://developers.facebook.com
- Express.js Guide: https://expressjs.com
- Mongoose Docs: https://mongoosejs.com

---

## üÜò Support

If you encounter issues:

1. Check Render logs
2. Verify environment variables
3. Check OAuth provider settings
4. Ensure MongoDB is connected
5. Test locally first with `.env.local`

---

**Congratulations! Your SWIFT CHOW app is now live! üéâ**
