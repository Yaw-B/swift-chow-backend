<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Order - SWIFT CHOW</title>
    <meta name="description" content="Track your SWIFT CHOW order in real-time.">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="logo.png">
</head>
<body data-page="tracking">
    <script>
        // Protect this page - check token in localStorage
        (function() {
            // Function to check if user is authenticated
            function checkAuth() {
                const token = localStorage.getItem('authToken');
                const hasToken = !!token && token.length > 0;
                console.log('Tracking page: Token check -', hasToken ? 'Authenticated' : 'Not authenticated');
                
                if (!hasToken) {
                    console.log('Not authenticated, redirecting to login');
                    window.location.href = 'login.html?return=' + encodeURIComponent(window.location.pathname);
                }
            }
            
            // Check immediately and after scripts load
            checkAuth();
            setTimeout(checkAuth, 500);
        })();
    </script>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <img src="logo.png" alt="Swift Chow" style="height: 40px; width: auto;">
                </div>
                <span class="logo-text">SWIFT <span>CHOW</span></span>
            </a>
            
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="reviews.html">Reviews</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            
            <div class="nav-actions">
                <button class="nav-icon dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="cart.html" class="nav-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" style="display: none;">0</span>
                </a>
                <button id="loginBtn" class="btn btn-primary btn-sm">
                    <i class="fas fa-user"></i> Login
                </button>
                <button class="mobile-menu-btn" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>
    
    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <ul class="mobile-nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="login.html">Login</a></li>
        </ul>
    </nav>
    
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1>Track Your Order</h1>
            <p>See the status of your delivery in real-time</p>
            <div class="breadcrumb">
                <a href="index.html">Home</a>
                <span>/</span>
                <span>Track Order</span>
            </div>
        </div>
    </div>
    
    <!-- Premium Tracking Section -->
    <section class="premium-tracking-section">
        <div class="premium-tracking-container">
            <!-- Left Sidebar Panel -->
            <aside class="tracking-sidebar">
                <div class="tracking-search-card">
                    <h3>Find Your Order</h3>
                    <form class="track-order-form">
                        <div class="form-group">
                            <label>Order ID</label>
                            <input type="text" placeholder="e.g., SWIFT-ABC123" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </form>
                </div>

                <!-- Recent Orders Section -->
                <div class="tracking-search-card" id="recentOrdersCard" style="display: none;">
                    <h3><i class="fas fa-history"></i> Recent Orders</h3>
                    <div id="recentOrdersList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <!-- Recent orders will be populated here -->
                    </div>
                </div>
                
                <div class="tracking-info-card">
                    <h4><i class="fas fa-info-circle"></i> Order Summary</h4>
                    <div id="orderSummary" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <p>Enter an order ID and search to view details</p>
                    </div>
                </div>
                
                <div class="tracking-contact-card">
                    <h4><i class="fas fa-headset"></i> Need Help?</h4>
                    <p>Contact our support team anytime</p>
                    <a href="tel:+233505070941" class="btn btn-outline btn-full">
                        <i class="fas fa-phone"></i> +233 50 507 0941
                    </a>
                    <a href="mailto:support@swiftchow.com" class="btn btn-outline btn-full" style="margin-top: 0.5rem;">
                        <i class="fas fa-envelope"></i> Email Support
                    </a>
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <main class="tracking-content-area">
                
                <!-- Order Status Header -->
                <div class="tracking-status-header">
                    <div>
                        <h2>Track Your Order</h2>
                        <p class="order-reference" id="orderRefDisplay">Enter an order ID to start tracking</p>
                    </div>
                    <div class="status-badge in-progress" id="statusBadge" style="display: none;">
                        <i class="fas fa-spinner"></i> In Progress
                    </div>
                </div>
                
                <!-- Enhanced Tracking Progress Bar Component -->
                <style>
                    .swift-tracking-container {
                        background: linear-gradient(135deg, 
                            #ffffff 0%, 
                            #f9f9f9 100%);
                        border-radius: 2.5rem;
                        padding: 3rem 2rem;
                        margin: 2rem 0;
                        position: relative;
                        border: 1.5px solid rgba(220, 38, 38, 0.2);
                        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1),
                                    0 25px 60px rgba(220, 38, 38, 0.08);
                        overflow: hidden;
                    }

                    [data-theme="dark"] .swift-tracking-container {
                        background: linear-gradient(135deg, 
                            #1a1a1a 0%, 
                            #242424 100%);
                        border-color: rgba(220, 38, 38, 0.4);
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                                    0 25px 60px rgba(220, 38, 38, 0.15);
                    }

                    .swift-tracking-container::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        right: -50%;
                        width: 200%;
                        height: 200%;
                        background: radial-gradient(circle, rgba(220, 38, 38, 0.05) 0%, transparent 70%);
                        animation: tracking-float 20s ease-in-out infinite;
                        z-index: 0;
                    }

                    @keyframes tracking-float {
                        0%, 100% { transform: translate(0, 0); }
                        50% { transform: translate(20px, 20px); }
                    }

                    @media (min-width: 768px) {
                        .swift-tracking-container {
                            padding: 4rem 3rem;
                        }
                    }

                    .tracking-progress-track {
                        position: absolute;
                        top: 2.5rem;
                        left: 3rem;
                        right: 3rem;
                        height: 4px;
                        background: linear-gradient(90deg, 
                            rgba(220, 38, 38, 0.1) 0%, 
                            rgba(220, 38, 38, 0.05) 100%);
                        border-radius: 10px;
                        z-index: 1;
                        overflow: hidden;
                        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
                    }

                    @media (min-width: 768px) {
                        .tracking-progress-track {
                            top: 2rem;
                            left: 5rem;
                            right: 5rem;
                            height: 5px;
                        }
                    }

                    .tracking-progress-fill {
                        height: 100%;
                        background: linear-gradient(90deg, 
                            #dc2626 0%, 
                            #ef4444 50%,
                            #dc2626 100%);
                        background-size: 200% 100%;
                        border-radius: 10px;
                        width: 0%;
                        transition: width 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 30px rgba(220, 38, 38, 0.6),
                                    0 0 60px rgba(220, 38, 38, 0.3),
                                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
                        animation: tracking-shimmer 2s ease-in-out infinite;
                    }

                    @keyframes tracking-shimmer {
                        0%, 100% { background-position: 0% center; }
                        50% { background-position: 100% center; }
                    }

                    /* Motorcycle Delivery Icon */
                    .tracking-motorcycle {
                        position: absolute;
                        top: 1.8rem;
                        left: 3rem;
                        font-size: 1.8rem;
                        z-index: 4;
                        filter: drop-shadow(0 4px 12px rgba(220, 38, 38, 0.5));
                        transition: left 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        animation: rider-bounce 0.5s ease-in-out infinite;
                    }

                    @media (min-width: 768px) {
                        .tracking-motorcycle {
                            top: 1.4rem;
                            font-size: 2rem;
                        }
                    }

                    @keyframes rider-bounce {
                        0%, 100% { transform: translateY(0px); }
                        50% { transform: translateY(-6px); }
                    }

                    .tracking-steps {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        position: relative;
                        z-index: 2;
                    }

                    .tracking-step {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        flex: 1;
                        opacity: 0.5;
                        transition: opacity 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                    }

                    .tracking-step.active,
                    .tracking-step.completed {
                        opacity: 1;
                    }

                    .tracking-step-circle {
                        width: 3rem;
                        height: 3rem;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-bottom: 1.2rem;
                        position: relative;
                        z-index: 3;
                        border: 2.5px solid rgba(220, 38, 38, 0.25);
                        background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
                        color: rgba(220, 38, 38, 0.5);
                        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08),
                                    inset 0 1px 0 rgba(255, 255, 255, 0.5),
                                    inset 0 -2px 4px rgba(0, 0, 0, 0.05);
                    }

                    [data-theme="dark"] .tracking-step-circle {
                        background: linear-gradient(135deg, #2a2a2a 0%, #333333 100%);
                        border-color: rgba(220, 38, 38, 0.4);
                        color: rgba(220, 38, 38, 0.7);
                        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3),
                                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                                    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
                    }

                    .tracking-step-circle i {
                        font-size: 1.3rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        line-height: 1;
                        height: 1.3rem;
                        width: 1.3rem;
                    }

                    @media (min-width: 768px) {
                        .tracking-step-circle {
                            width: 3.5rem;
                            height: 3.5rem;
                            margin-bottom: 1.5rem;
                        }

                        .tracking-step-circle i {
                            font-size: 1.5rem;
                            height: 1.5rem;
                            width: 1.5rem;
                        }
                    }

                    /* Completed Step Circle */
                    .tracking-step.completed .tracking-step-circle {
                        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
                        border-color: #7f1d1d;
                        color: white;
                        box-shadow: 0 12px 32px rgba(220, 38, 38, 0.6),
                                    0 0 20px rgba(220, 38, 38, 0.5),
                                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                                    inset 0 -2px 4px rgba(0, 0, 0, 0.2);
                        transform: scale(1);
                    }

                    /* Active Step Circle - Premium Pulse */
                    .tracking-step.active .tracking-step-circle {
                        background: linear-gradient(135deg, white, #f0f0f0);
                        border-color: #dc2626;
                        border-width: 3px;
                        color: #dc2626;
                        box-shadow: 0 0 0 8px rgba(220, 38, 38, 0.12),
                                    0 12px 32px rgba(220, 38, 38, 0.4),
                                    inset 0 2px 8px rgba(255, 255, 255, 0.9),
                                    inset 0 -2px 4px rgba(0, 0, 0, 0.08);
                        animation: tracking-pulse-premium 2s ease-in-out infinite;
                    }

                    @keyframes tracking-pulse-premium {
                        0%, 100% {
                            box-shadow: 0 0 0 6px rgba(220, 38, 38, 0.15),
                                        0 12px 32px rgba(220, 38, 38, 0.35),
                                        inset 0 2px 8px rgba(255, 255, 255, 0.8);
                            transform: scale(1);
                        }
                        50% {
                            box-shadow: 0 0 0 12px rgba(220, 38, 38, 0.08),
                                        0 16px 40px rgba(220, 38, 38, 0.45),
                                        inset 0 2px 8px rgba(255, 255, 255, 0.8);
                            transform: scale(1.08);
                        }
                    }

                    /* Checkmark Animation */
                    .tracking-checkmark {
                        opacity: 0;
                        transform: scale(0);
                        animation: tracking-checkmark-pop-premium 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
                    }

                    @keyframes tracking-checkmark-pop-premium {
                        0% {
                            opacity: 0;
                            transform: scale(0) rotate(-180deg);
                        }
                        70% {
                            transform: scale(1.3) rotate(15deg);
                        }
                        100% {
                            opacity: 1;
                            transform: scale(1) rotate(0);
                        }
                    }

                    /* Step Label */
                    .tracking-step-label {
                        text-align: center;
                        width: 100%;
                    }

                    .tracking-step-title {
                        font-size: 0.9rem;
                        font-weight: 700;
                        color: rgba(0, 0, 0, 0.45);
                        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                        line-height: 1.4;
                        margin-bottom: 0.4rem;
                        letter-spacing: 0.3px;
                    }

                    [data-theme="dark"] .tracking-step-title {
                        color: rgba(255, 255, 255, 0.6);
                    }

                    @media (min-width: 768px) {
                        .tracking-step-title {
                            font-size: 1rem;
                        }
                    }

                    .tracking-step.active .tracking-step-title,
                    .tracking-step.completed .tracking-step-title {
                        color: #dc2626;
                        font-weight: 800;
                        transform: translateY(-2px);
                    }

                    .tracking-step-time {
                        font-size: 0.8rem;
                        color: rgba(0, 0, 0, 0.5);
                        opacity: 0.6;
                        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                        font-weight: 500;
                    }

                    [data-theme="dark"] .tracking-step-time {
                        color: rgba(255, 255, 255, 0.5);
                    }

                    @media (min-width: 768px) {
                        .tracking-step-time {
                            font-size: 0.85rem;
                        }
                    }

                    .tracking-step.active .tracking-step-time,
                    .tracking-step.completed .tracking-step-time {
                        opacity: 1;
                        color: #dc2626;
                        font-weight: 600;
                    }

                    /* Status Badge */
                    .tracking-status-badge {
                        display: inline-block;
                        background: linear-gradient(135deg, rgba(220, 38, 38, 0.08), rgba(220, 38, 38, 0.04));
                        color: #dc2626;
                        padding: 0.55rem 1.2rem;
                        border-radius: 20px;
                        font-size: 0.75rem;
                        font-weight: 700;
                        margin-top: 1.2rem;
                        border: 1.5px solid rgba(220, 38, 38, 0.25);
                        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                        letter-spacing: 0.4px;
                        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.08);
                    }

                    @media (min-width: 768px) {
                        .tracking-status-badge {
                            font-size: 0.8rem;
                            padding: 0.6rem 1.4rem;
                        }
                    }

                    .tracking-status-badge.active {
                        background: linear-gradient(135deg, #dc2626, #991b1b);
                        color: white;
                        border-color: #dc2626;
                        box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4),
                                    0 0 20px rgba(220, 38, 38, 0.3);
                        animation: tracking-badge-pulse-premium 2s ease-in-out infinite;
                        transform: scale(1.05);
                    }

                    @keyframes tracking-badge-pulse-premium {
                        0%, 100% { 
                            box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4),
                                        0 0 20px rgba(220, 38, 38, 0.3);
                        }
                        50% { 
                            box-shadow: 0 12px 32px rgba(220, 38, 38, 0.5),
                                        0 0 30px rgba(220, 38, 38, 0.4);
                        }
                    }

                    .tracking-status-badge.completed {
                        background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(16, 185, 129, 0.06));
                        color: #10b981;
                        border-color: rgba(16, 185, 129, 0.4);
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.12);
                    }

                    /* Helper text */
                    .tracking-helper-text {
                        font-size: 1.15rem;
                        color: rgba(0, 0, 0, 0.75);
                        margin-top: 2.5rem;
                        text-align: center;
                        font-weight: 600;
                        letter-spacing: 0.3px;
                        line-height: 1.6;
                    }

                    [data-theme="dark"] .tracking-helper-text {
                        color: rgba(255, 255, 255, 0.85);
                    }

                    @media (min-width: 768px) {
                        .tracking-helper-text {
                            font-size: 1.3rem;
                            margin-top: 3rem;
                            font-weight: 700;
                        }
                    }

                    @media (max-width: 640px) {
                        .tracking-step-title {
                            max-width: 85px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                        }
                    }
                </style>

                <div class="swift-tracking-container" id="trackingContainer" style="display: none;">
                    <div class="tracking-motorcycle" id="trackingMotorcycle">
                        <i class="fas fa-person-biking" style="color: #dc2626;"></i>
                    </div>
                    
                    <div class="tracking-progress-track">
                        <div class="tracking-progress-fill" id="trackingProgressFill"></div>
                    </div>

                    <div class="tracking-steps" id="trackingSteps">
                        <div class="tracking-step" data-step="1">
                            <div class="tracking-step-circle">
                                <i class="fas fa-check" style="opacity: 0;"></i>
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="tracking-step-label">
                                <div class="tracking-step-title">Order Confirmed</div>
                                <div class="tracking-step-time" data-time="--:--">--:--</div>
                                <div class="tracking-status-badge">Confirmed</div>
                            </div>
                        </div>

                        <div class="tracking-step" data-step="2">
                            <div class="tracking-step-circle">
                                <i class="fas fa-check" style="opacity: 0;"></i>
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="tracking-step-label">
                                <div class="tracking-step-title">Being Prepared</div>
                                <div class="tracking-step-time" data-time="--:--">--:--</div>
                                <div class="tracking-status-badge">Preparing</div>
                            </div>
                        </div>

                        <div class="tracking-step" data-step="3">
                            <div class="tracking-step-circle">
                                <i class="fas fa-check" style="opacity: 0;"></i>
                                <i class="fas fa-person-biking"></i>
                            </div>
                            <div class="tracking-step-label">
                                <div class="tracking-step-title">Out for Delivery</div>
                                <div class="tracking-step-time" data-time="--:--">--:--</div>
                                <div class="tracking-status-badge">En Route</div>
                            </div>
                        </div>

                        <div class="tracking-step" data-step="4">
                            <div class="tracking-step-circle">
                                <i class="fas fa-check" style="opacity: 0;"></i>
                                <i class="fas fa-door-open"></i>
                            </div>
                            <div class="tracking-step-label">
                                <div class="tracking-step-title">Delivered</div>
                                <div class="tracking-step-time" data-time="--:--">--:--</div>
                                <div class="tracking-status-badge">Delivered</div>
                            </div>
                        </div>
                    </div>

                    <div class="tracking-helper-text">
                        <span id="trackingCurrentStatus">Order confirmed! Your food is being prepared.</span>
                    </div>
                </div>

                <script>
                    class OrderTracker {
                        constructor() {
                            this.currentStep = 2;
                            this.totalSteps = 4;
                            this.steps = document.querySelectorAll('.tracking-step');
                            this.progressFill = document.getElementById('trackingProgressFill');
                            this.statusText = document.getElementById('trackingCurrentStatus');
                            
                            this.stepInfo = [
                                { title: "Order Confirmed", messages: ["Order confirmed! Your food is being prepared.", "We've received your order and sent it to the kitchen."] },
                                { title: "Being Prepared", messages: ["Your food is being prepared with care.", "Our chefs are preparing your delicious order."] },
                                { title: "Out for Delivery", messages: ["Your order is out for delivery!", "Your driver is on the way with your order."] },
                                { title: "Delivered", messages: ["Your order has been delivered!", "Thank you for ordering with SWIFT CHOW!"] }
                            ];
                            
                            this.init();
                        }

                        init() {
                            this.updateUI();
                        }

                        setStep(step) {
                            if (step >= 1 && step <= this.totalSteps) {
                                this.currentStep = step;
                                this.updateUI();
                            }
                        }

                        nextStep() {
                            if (this.currentStep < this.totalSteps) {
                                this.currentStep++;
                                this.updateUI();
                            }
                        }

                        updateUI() {
                            const progress = ((this.currentStep - 1) / (this.totalSteps - 1)) * 100;
                            this.progressFill.style.width = `${progress}%`;

                            // Update delivery rider position to follow the progress bar
                            const motorcycle = document.getElementById('trackingMotorcycle');
                            if (motorcycle) {
                                const progressTrack = document.querySelector('.tracking-progress-track');
                                const container = document.querySelector('.swift-tracking-container');
                                
                                // Get computed positions
                                const trackStyle = window.getComputedStyle(progressTrack);
                                const containerRect = container.getBoundingClientRect();
                                const trackRect = progressTrack.getBoundingClientRect();
                                
                                // Calculate rider position relative to container
                                const trackLeftPixels = trackRect.left - containerRect.left;
                                const trackWidthPixels = trackRect.width;
                                const riderPos = trackLeftPixels + (trackWidthPixels * progress / 100);
                                
                                // Adjust for icon centering (subtract half the icon width)
                                motorcycle.style.left = (riderPos - 12) + 'px';
                            }

                            this.steps.forEach((stepElement, index) => {
                                const stepNum = parseInt(stepElement.dataset.step);
                                const circle = stepElement.querySelector('.tracking-step-circle');
                                const timeEl = stepElement.querySelector('.tracking-step-time');
                                const badge = stepElement.querySelector('.tracking-status-badge');
                                const checkIcon = stepElement.querySelector('.fa-check');
                                const otherIcon = circle.querySelector('i:not(.fa-check)');

                                stepElement.classList.remove('active', 'completed');

                                if (stepNum < this.currentStep) {
                                    stepElement.classList.add('completed');
                                    
                                    if (checkIcon && checkIcon.style.opacity !== '1') {
                                        checkIcon.style.opacity = '1';
                                        checkIcon.classList.add('tracking-checkmark');
                                        otherIcon.style.display = 'none';
                                    }
                                    
                                    const completedTime = this.generateTime(stepNum);
                                    timeEl.textContent = completedTime;
                                    timeEl.dataset.time = completedTime;
                                    
                                    badge.classList.remove('active');
                                    badge.classList.add('completed');
                                    badge.textContent = 'âœ“ Completed';
                                } 
                                else if (stepNum === this.currentStep) {
                                    stepElement.classList.add('active');
                                    
                                    if (checkIcon) checkIcon.style.opacity = '0';
                                    otherIcon.style.display = 'inline-block';
                                    
                                    timeEl.textContent = 'In Progress';
                                    
                                    badge.classList.remove('completed');
                                    badge.classList.add('active');
                                } 
                                else {
                                    if (checkIcon) checkIcon.style.opacity = '0';
                                    otherIcon.style.display = 'inline-block';
                                    timeEl.textContent = '--:--';
                                    badge.classList.remove('active', 'completed');
                                }
                            });

                            this.updateStatusMessage();
                        }

                        generateTime(step) {
                            const baseTime = new Date('2026-02-09T12:10:00');
                            const offsets = [0, 5, 25, 40];
                            const time = new Date(baseTime.getTime() + offsets[step - 1] * 60000);
                            return time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        }

                        updateStatusMessage() {
                            const messages = this.stepInfo[this.currentStep - 1].messages;
                            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                            this.statusText.textContent = randomMessage;
                        }
                    }

                    const tracker = new OrderTracker();
                    window.updateOrderStep = (step) => tracker.setStep(step);
                    window.advanceOrderStep = () => tracker.nextStep();

                    // Load and display recent orders
                    function loadRecentOrders() {
                        const recentOrdersCard = document.getElementById('recentOrdersCard');
                        const recentOrdersList = document.getElementById('recentOrdersList');
                        
                        // Get orders from localStorage or sessionStorage
                        let orders = [];
                        try {
                            // Try sessionStorage first (most recent order)
                            const lastOrder = sessionStorage.getItem('lastOrder');
                            if (lastOrder) {
                                const order = JSON.parse(lastOrder);
                                orders.push(order);
                            }
                            
                            // Get all orders from localStorage
                            const allOrders = localStorage.getItem('fafoOrders');
                            if (allOrders) {
                                const ordersArray = JSON.parse(allOrders);
                                if (Array.isArray(ordersArray)) {
                                    // Add orders that aren't already in the list
                                    ordersArray.forEach(order => {
                                        if (!orders.find(o => o.id === order.id)) {
                                            orders.push(order);
                                        }
                                    });
                                }
                            }
                        } catch (e) {
                            console.error('Error loading orders:', e);
                        }
                        
                        if (orders.length > 0) {
                            recentOrdersCard.style.display = 'block';
                            recentOrdersList.innerHTML = orders.slice(0, 5).map((order, index) => {
                                const orderDate = new Date(order.date || order.timestamp);
                                const formattedDate = orderDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                                const status = order.status || 'In Progress';
                                
                                return `
                                    <button type="button" style="
                                        background: var(--bg-secondary);
                                        border: 1px solid var(--border-color);
                                        border-radius: 0.5rem;
                                        padding: 0.75rem 1rem;
                                        cursor: pointer;
                                        text-align: left;
                                        transition: all 0.3s ease;
                                        font-family: inherit;
                                    " 
                                    onmouseover="this.style.borderColor = 'var(--primary)'; this.style.background = 'rgba(220, 38, 38, 0.05)';"
                                    onmouseout="this.style.borderColor = 'var(--border-color)'; this.style.background = 'var(--bg-secondary)';"
                                    onclick="
                                        document.querySelector('.track-order-form input').value = '${order.id}';
                                        loadOrder('${order.id}');
                                        document.querySelector('.tracking-status-header').scrollIntoView({ behavior: 'smooth', block: 'start' });
                                    ">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                            <strong style="font-size: 0.9rem;">${order.id}</strong>
                                            <span style="font-size: 0.75rem; color: var(--text-secondary);">${formattedDate}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 0.85rem; color: var(--text-secondary);">GHS ${parseFloat(order.total || 0).toFixed(2)}</span>
                                            <span style="font-size: 0.75rem; color: #10b981; font-weight: 500;">${status}</span>
                                        </div>
                                    </button>
                                `;
                            }).join('');
                        }
                    }
                    
                    // Load orders on page load
                    loadRecentOrders();
                    
                    // Function to load and display a specific order
                    window.loadOrder = function(orderId) {
                        let order = null;
                        console.log('loadOrder called with ID:', orderId);
                        
                        try {
                            // Check sessionStorage first
                            const lastOrder = sessionStorage.getItem('lastOrder');
                            console.log('sessionStorage lastOrder exists:', !!lastOrder);
                            if (lastOrder) {
                                const parsed = JSON.parse(lastOrder);
                                console.log('sessionStorage order ID:', parsed.id);
                                if (parsed.id === orderId) {
                                    order = parsed;
                                    console.log('Order found in sessionStorage');
                                }
                            }
                            
                            // Check localStorage
                            if (!order) {
                                const allOrders = localStorage.getItem('fafoOrders');
                                console.log('localStorage fafoOrders exists:', !!allOrders);
                                if (allOrders) {
                                    const ordersArray = JSON.parse(allOrders);
                                    console.log('Orders in localStorage:', ordersArray.length);
                                    order = ordersArray.find(o => o.id === orderId);
                                    if (order) console.log('Order found in localStorage');
                                }
                            }
                        } catch (e) {
                            console.error('Error loading order:', e);
                        }
                        
                        if (order) {
                            // Display order in tracking system
                            document.getElementById('trackingContainer').style.display = 'block';
                            document.getElementById('statusBadge').style.display = 'block';
                            document.getElementById('orderRefDisplay').textContent = 'Order ' + order.id + ' | ' + new Date(order.date).toLocaleDateString();
                            
                            // Update order summary - handle both customer formats
                            const customer = order.customer || { firstName: order.firstName || 'N/A', lastName: order.lastName || 'N/A' };
                            const firstName = customer.firstName || order.firstName || 'N/A';
                            const lastName = customer.lastName || order.lastName || 'N/A';
                            
                            const orderSummary = document.getElementById('orderSummary');
                            orderSummary.innerHTML = `
                                <div style="text-align: left; padding: 1rem 0;">
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="font-weight: 600; display: block; color: var(--text-primary); margin-bottom: 0.25rem;">Delivery To:</span>
                                        <span style="font-size: 0.9rem; color: var(--text-secondary);">${firstName} ${lastName}</span>
                                    </div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="font-weight: 600; display: block; color: var(--text-primary); margin-bottom: 0.25rem;">Total:</span>
                                        <span style="font-size: 1.1rem; font-weight: 700; color: var(--primary);">GHS ${parseFloat(order.total || 0).toFixed(2)}</span>
                                    </div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="font-weight: 600; display: block; color: var(--text-primary); margin-bottom: 0.25rem;">Items:</span>
                                        <span style="font-size: 0.9rem; color: var(--text-secondary);">${order.items ? order.items.length : 0} item${order.items && order.items.length !== 1 ? 's' : ''}</span>
                                    </div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="font-weight: 600; display: block; color: var(--text-primary); margin-bottom: 0.25rem;">Time Ordered:</span>
                                        <span style="font-size: 0.9rem; color: var(--text-secondary);" id="trackedOrderTime"></span>
                                    </div>
                                    <div>
                                        <span style="font-weight: 600; display: block; color: var(--text-primary); margin-bottom: 0.25rem;">Est. Delivery:</span>
                                        <span style="font-size: 0.9rem; color: var(--text-secondary);" id="trackedDeliveryTime"></span>
                                    </div>
                                </div>
                            `;
                            
                            // Set order time display
                            const orderTime = order.orderTime ? new Date(order.orderTime) : new Date(order.timestamp);
                            const orderTimeEl = document.getElementById('trackedOrderTime');
                            if (orderTimeEl) {
                                orderTimeEl.textContent = orderTime.toLocaleTimeString('en-US', {
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    hour12: true
                                });
                            }
                            
                            // Animate progress based on real order time
                            animateOrderProgress(order, orderTime);
                        }
                    };
                    
                    // Function to animate progress bar based on real order time
                    function animateOrderProgress(order, orderTime) {
                        const deliveryTimes = {
                            'Accra': { prep: 15, delivery: 20, total: 35 },
                            'Kumasi': { prep: 20, delivery: 25, total: 45 },
                            'Tema': { prep: 15, delivery: 18, total: 33 },
                            'Sekondi-Takoradi': { prep: 20, delivery: 30, total: 50 },
                            'Cape Coast': { prep: 20, delivery: 35, total: 55 },
                            'Tamale': { prep: 25, delivery: 40, total: 65 },
                            'Warri': { prep: 20, delivery: 30, total: 50 }
                        };
                        
                        const city = order.city || 'Accra';
                        const times = deliveryTimes[city] || { prep: 20, delivery: 25, total: 45 };
                        const totalMinutes = times.total;
                        
                        // Calculate elapsed time since order
                        const now = new Date();
                        const elapsedMinutes = (now - orderTime) / (1000 * 60);
                        const progress = Math.min((elapsedMinutes / totalMinutes) * 100, 100);
                        
                        // Calculate which step the order is at
                        const prepEndTime = times.prep;
                        const deliveryEndTime = times.prep + times.delivery;
                        
                        let currentStep = 1;
                        if (elapsedMinutes >= deliveryEndTime) currentStep = 4;
                        else if (elapsedMinutes >= prepEndTime + times.delivery * 0.5) currentStep = 3;
                        else if (elapsedMinutes >= prepEndTime) currentStep = 2;
                        
                        // Update tracker
                        tracker.setStep(currentStep);
                        
                        // Update delivery time display
                        const deliveryTime = new Date(orderTime.getTime() + totalMinutes * 60000);
                        const deliveryTimeEl = document.getElementById('trackedDeliveryTime');
                        if (deliveryTimeEl) {
                            deliveryTimeEl.textContent = deliveryTime.toLocaleTimeString('en-US', {
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: true
                            });
                        }
                        
                        // Continue updating progress in real-time
                        const progressInterval = setInterval(() => {
                            const currentTime = new Date();
                            const newElapsedMinutes = (currentTime - orderTime) / (1000 * 60);
                            const newProgress = Math.min((newElapsedMinutes / totalMinutes) * 100, 100);
                            
                            if (newElapsedMinutes >= deliveryEndTime) {
                                tracker.setStep(4);
                                clearInterval(progressInterval);
                            } else if (newElapsedMinutes >= prepEndTime + times.delivery * 0.5) {
                                tracker.setStep(3);
                            } else if (newElapsedMinutes >= prepEndTime) {
                                tracker.setStep(2);
                            }
                            
                            // Update progress bar smoothly
                            const progressFill = document.getElementById('trackingProgressFill');
                            if (progressFill) {
                                progressFill.style.width = newProgress + '%';
                            }
                        }, 1000); // Update every second for smooth animation
                    }
                    };
                </script>
                
                <!-- Order Details - Will be populated by JavaScript -->
                <div id="orderDetailsContainer" class="order-details-card">
                    <!-- Dynamic order details will be rendered here -->
                </div>
                
            </main>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">
                            <img src="logo.jpg" alt="Swift Chow" style="height: 40px; width: auto;">
                        </div>
                        <span class="logo-text">SWIFT <span>CHOW</span></span>
                    </a>
                    <p>Ghana's favorite fast food destination. Fresh ingredients, amazing taste, and lightning-fast delivery.</p>
                    <div class="footer-social">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="menu.html">Our Menu</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="reviews.html">Reviews</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="tracking.html">Track Order</a></li>
                        <li><a href="terms.html">Terms & Conditions</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="contact.html#faq">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Contact Us</h4>
                    <div class="footer-contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>25 Independence Ave, Osu, Accra, Ghana</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-phone"></i>
                        <span>+233 50 507 0941</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>orders@swiftchow.com</span>
                    </div>
                    <div class="footer-contact-item">
                        <i class="fas fa-clock"></i>
                        <span>Mon-Sun: 8:00 AM - 10:00 PM</span>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 SWIFT CHOW. Designed by Ayensu Edwin Yaw Boadi</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript Files - Order matters! -->
    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>

    <!-- LOGIN MODAL -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
            
            <div class="modal-header">
                <a href="#" class="logo">
                    <div class="logo-icon"><i class="fas fa-bolt"></i></div>
                    <div class="logo-text">SWIFT <span>CHOW</span></div>
                </a>
                <h2>Welcome Back!</h2>
                <p>Log in to your account to continue</p>
            </div>

            <div class="modal-body">
                <form id="loginModalForm" class="form">
                    <div class="form-group">
                        <label for="login-email">Email Address</label>
                        <input type="email" id="login-email" name="email" placeholder="your@email.com" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Email verified</div>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" placeholder="Enter your password" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Password valid</div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 1rem 0;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="remember">
                            <span>Remember me</span>
                        </label>
                        <a href="forgot-password.html" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 1.5rem;">Sign In</button>
                </form>

                <div style="margin: 2rem 0; position: relative;">
                    <div style="border-top: 1px solid var(--border-color);"></div>
                    <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--bg-primary); padding: 0 1rem; color: var(--text-secondary); font-size: 0.85rem;">or continue with</span>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button type="button" class="btn btn-outline" onclick="googleSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-google"></i> Google</button>
                    <button type="button" class="btn btn-outline" onclick="facebookSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-facebook"></i> Facebook</button>
                </div>
            </div>

            <div class="modal-footer">
                Don't have an account? <a href="#" data-action="switch-to-signup">Sign up</a>
            </div>
        </div>
    </div>

    <!-- SIGNUP MODAL -->
    <div id="signupModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
            
            <div class="modal-header">
                <a href="#" class="logo">
                    <div class="logo-icon"><i class="fas fa-bolt"></i></div>
                    <div class="logo-text">SWIFT <span>CHOW</span></div>
                </a>
                <h2>Join Us!</h2>
                <p>Create your account to start ordering</p>
            </div>

            <div class="modal-body">
                <form id="signupModalForm" class="form">
                    <div class="form-group">
                        <label for="signup-fullname">Full Name</label>
                        <input type="text" id="signup-fullname" name="fullName" placeholder="Your full name" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Name valid</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" name="email" placeholder="your@email.com" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Email verified</div>
                    </div>

                    <div class="form-group">
                        <label for="signup-phone">Phone Number</label>
                        <input type="tel" id="signup-phone" name="phone" placeholder="+233 50 507 0941" required>
                        <div class="form-feedback error" style="display: none;"></div>
                        <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Phone valid</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" name="password" placeholder="At least 6 characters" required>
                            <div class="form-feedback error" style="display: none;"></div>
                            <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Password valid</div>
                        </div>
                        <div class="form-group">
                            <label for="signup-confirm">Confirm Password</label>
                            <input type="password" id="signup-confirm" name="confirmPassword" placeholder="Confirm password" required>
                            <div class="form-feedback error" style="display: none;"></div>
                            <div class="form-feedback success" style="display: none;"><i class="fas fa-check"></i> Passwords match</div>
                        </div>
                    </div>

                    <label style="display: flex; align-items: flex-start; gap: 0.5rem; margin: 1rem 0; cursor: pointer;">
                        <input type="checkbox" name="terms" required style="margin-top: 0.3rem;">
                        <span style="font-size: 0.9rem;">I agree to the <a href="terms.html" style="color: var(--primary);">Terms & Conditions</a></span>
                    </label>

                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 1.5rem;">Create Account</button>
                </form>

                <div style="margin: 2rem 0; position: relative;">
                    <div style="border-top: 1px solid var(--border-color);"></div>
                    <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--bg-primary); padding: 0 1rem; color: var(--text-secondary); font-size: 0.85rem;">or sign up with</span>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button type="button" class="btn btn-outline" onclick="googleSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-google"></i> Google</button>
                    <button type="button" class="btn btn-outline" onclick="facebookSignIn()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i class="fab fa-facebook"></i> Facebook</button>
                </div>
            </div>

            <div class="modal-footer">
                Already have an account? <a href="#" data-action="switch-to-login">Sign in</a>
            </div>
        </div>
    </div>

    <!-- CART MODAL PANEL -->
    <div id="cartModal" class="modal-overlay">
        <div class="modal-content" style="position: fixed; right: 0; top: 0; max-width: 450px; height: 100vh; border-radius: 0; max-height: 100vh; overflow-y: auto; animation: slideInRight 0.3s ease;">
            <div style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0;"><i class="fas fa-shopping-cart"></i> Your Cart</h2>
                <button class="modal-close" onclick="closeModal(document.getElementById('cartModal')); document.body.style.overflow = 'auto';" aria-label="Close cart"><i class="fas fa-times" style="font-size: 1.5rem;"></i></button>
            </div>

            <div class="modal-body" style="padding: 1.5rem; padding-bottom: 200px; min-height: calc(100vh - 300px);">
                <div class="cart-items-modal-list">
                    <!-- Cart items will be rendered here by JavaScript -->
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; opacity: 0.5; margin-bottom: 1rem;"></i>
                        <p>Your cart is empty</p>
                        <a href="menu.html" class="btn btn-primary btn-sm" style="margin-top: 1rem;">Browse Menu</a>
                    </div>
                </div>
            </div>

            <div style="position: fixed; bottom: 0; right: 0; width: 450px; background: var(--bg-primary); border-top: 1px solid var(--border-color); padding: 1.5rem;">
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; font-size: 0.95rem;">
                        <span>Subtotal:</span>
                        <span class="cart-subtotal">GHS 0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); font-size: 0.95rem;">
                        <span>Delivery:</span>
                        <span class="cart-delivery">GHS 15.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem; color: var(--primary);">
                        <span>Total:</span>
                        <span class="cart-total">GHS 0.00</span>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                    <button class="btn btn-outline" onclick="closeModal(document.getElementById('cartModal')); document.body.style.overflow = 'auto';" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-arrow-left"></i> Continue
                    </button>
                    <button class="btn btn-primary" onclick="proceedToCheckout()" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-lock"></i> Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
